<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clay County Master Portal</title>
    <style>
        /* --- GLOBAL THEME --- */
        body { margin: 0; padding: 0; background: #000000; color: #ffffff; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .my-perfect-layout { display: flex; flex-direction: column; min-height: 100vh; }
        
        header { background: #000; padding: 15px; text-align: center; border-bottom: 3px solid #00ff00; }
        header h1 { color: #00ff00; margin: 0; text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; }

        /* --- WIDGET BAR (Clock & Weather) --- */
        .widget-bar { display: flex; justify-content: space-between; align-items: center; background: #111; padding: 8px 25px; border-bottom: 1px solid #333; }
        #live-clock { font-weight: bold; color: #00ff00; font-family: 'Courier New', monospace; }
        #weather-widget { font-weight: bold; }

        /* --- NAVIGATION --- */
        nav { background: #000; padding: 12px; display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; border-bottom: 1px solid #333; }
        .nav-link { text-decoration: none; padding: 10px 18px; font-weight: bold; text-transform: uppercase; font-size: 0.8rem; transition: 0.3s; border-radius: 5px; }

        /* --- TOWN COLOR SCHEMES (Menu & Cards) --- */
        
        /* Flora: Deep Blue / Vibrant Orange */
        .link-flora, .card-flora { background-color: #0c0b82 !important; color: #fe4f00 !important; border: 2px solid #fe4f00 !important; }
        .link-flora:hover, .card-flora:hover { background-color: #fe4f00 !important; color: #0c0b82 !important; }

        /* Louisville: Black / Cardinal Red */
        .link-louisville, .card-louisville { background-color: #050505 !important; color: #eb1c24 !important; border: 2px solid #eb1c24 !important; }
        .link-louisville:hover, .card-louisville:hover { background-color: #eb1c24 !important; color: #050505 !important; }

        /* Clay City: Blue / Grey */
        .link-clay-city, .card-clay-city { background-color: #0c30f0 !important; color: #b8b3ae !important; border: 2px solid #b8b3ae !important; }
        .link-clay-city:hover, .card-clay-city:hover { background-color: #b8b3ae !important; color: #0c30f0 !important; }

        .link-default { background: #222; color: #00ff00; }
        .link-default:hover { background: #00ff00; color: #000; }

        /* --- CONTENT AREA --- */
        #content-area { flex: 1; padding: 25px; max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        .news-card { 
            padding: 25px; 
            margin-bottom: 30px; 
            transition: 0.4s ease; 
            border-radius: 8px;
            cursor: default;
        }
        
        /* Standard Card (When no town detected) */
        .card-none { border-left: 8px solid #00ff00; background: #111; color: #ffffff; }

        .news-card h2 { margin-top: 0; color: inherit !important; }
        .story-body { white-space: pre-wrap; line-height: 1.6; font-size: 1.1rem; color: inherit !important; }
        
        iframe { width: 100%; height: 800px; border: none; background: white; }
    </style>
</head>
<body>

<div class="my-perfect-layout">
    <header><h1>Support My Local Community</h1></header>
    
    <div class="widget-bar">
        <div id="live-clock">00:00:00 AM</div>
        <div id="weather-widget">Loading Weather...</div>
    </div>
    
    <nav>
        <a href="?type=local-news" class="nav-link link-default">Full News</a>
        <a href="https://ourflora.com" class="nav-link link-flora" target="_blank">Flora</a>
        <a href="https://supportmylocalcommunity.com/louisville/" class="nav-link link-louisville" target="_blank">Louisville</a>
        <a href="https://supportmylocalcommunity.com/clay-city/" class="nav-link link-clay-city" target="_blank">Clay City</a>
        <a href="?type=gas" class="nav-link link-default">Gas Prices</a>
        <a href="?type=calendar" class="nav-link link-default">Calendar</a>
    </nav>
    
    <div id="content-area"></div>
</div>

<script>
// 1. CLOCK #lock
function updateClock() {
    const now = new Date();
    document.getElementById('live-clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
}
setInterval(updateClock, 1000);
updateClock();

// 2. WEATHER #lock
async function fetchWeather() {
    const widget = document.getElementById('weather-widget');
    try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=38.67&longitude=-88.48&current=temperature_2m,apparent_temperature,weather_code&temperature_unit=fahrenheit`);
        const data = await res.json();
        const temp = Math.round(data.current.temperature_2m);
        const code = data.current.weather_code;
        
        let cond = "Clear", col = "#00ff00";
        if (code >= 1 && code <= 3) { cond = "Cloudy"; col = "#a0a0a0"; }
        else if (code >= 51 && code <= 82) { cond = "Rainy"; col = "#3498db"; }
        
        widget.style.color = col;
        widget.innerHTML = `${cond} ${temp}Â°F`;
    } catch (e) { widget.innerText = "Weather Offline"; }
}
fetchWeather();

// 3. ROUTER & TOWN CARD LOGIC
async function loadPortal() {
    const contentDiv = document.getElementById('content-area');
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('type') || 'local-news'; 

    try {
        if (slug === 'gas') {
            const res = await fetch('https://kfruti88.github.io/Clay-County-Fuel/gas_prices.json');
            const data = await res.json();
            contentDiv.innerHTML = '<h2 style="text-align:center; color:#00ff00;">Local Gas Prices</h2>';
            data.forEach(item => {
                contentDiv.innerHTML += `
                    <div class="news-card card-none" style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:1.2rem; font-weight:bold;">${item.name || item.station}</span>
                        <span style="color:#00ff00; font-size:1.5rem; font-family:monospace;">${item.price}</span>
                    </div>`;
            });
        } 
        else if (slug === 'calendar') {
            contentDiv.innerHTML = `<h2 style="text-align:center; color:#00ff00;">Community Calendar</h2>
                <iframe src="https://calendar.google.com/calendar/embed?src=ceab82d01e29c237da2e761555f2d2c2da76431b94e0def035ff04410e2cd71d%40group.calendar.google.com&ctz=America%2FNew_York"></iframe>`;
        }
        else {
            const res = await fetch('https://kfruti88.github.io/clay-county-news/news_data.json');
            const data = await res.json();
            contentDiv.innerHTML = '<h2 style="text-align:center; color:#00ff00;">Latest Full Stories</h2>';
            
            data.forEach(item => {
                let townClass = "card-none";
                const text = (item.title + item.full_story).toLowerCase();

                // Determine Town Theme
                if (text.includes("flora")) {
                    townClass = "card-flora";
                } else if (text.includes("louisville") || text.includes("north clay")) {
                    townClass = "card-louisville";
                } else if (text.includes("clay city")) {
                    townClass = "card-clay-city";
                }

                contentDiv.innerHTML += `
                    <div class="news-card ${townClass}">
                        <h2>${item.title}</h2>
                        <p style="opacity: 0.8; font-size:0.8rem;">${item.date}</p>
                        <div class="story-body">${item.full_story}</div>
                    </div>`;
            });
        }
    } catch (e) {
        contentDiv.innerHTML = `<p style="text-align:center; color:red;">Syncing Module...</p>`;
    }
}
loadPortal();
</script>
</body>
</html>
