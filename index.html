<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clay County Master Portal</title>
    <style>
        /* --- 1. GLOBAL LAYOUT (Locked) --- */
        body { margin: 0; padding: 0; background: #121212; color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .my-perfect-layout { display: flex; flex-direction: column; min-height: 100vh; width: 100%; }
        header { background: #1f1f1f; padding: 20px; text-align: center; border-bottom: 3px solid #00ff00; }
        footer { text-align: center; padding: 20px; color: #444; font-size: 0.8rem; margin-top: auto; }

        /* --- 2. FLEXIBLE FLOW (No Overlapping) --- */
        #content-area { flex: 1; width: 100%; padding: 20px; box-sizing: border-box; position: relative; }
        #content-area > * { position: relative !important; display: block !important; width: 100% !important; margin-bottom: 20px; clear: both; }

        /* --- 3. RESPONSIVE RULES --- */
        @media (max-width: 980px) { header h1 { font-size: 1.2rem; } #content-area { padding: 10px; } }
        @media (min-width: 1600px) { #content-area { max-width: 1440px; margin: 0 auto; } }

        /* --- 4. NEWS CARD & BUTTON STYLES --- */
        .news-card { background: #1f1f1f; padding: 20px; border-radius: 8px; border-left: 4px solid #00ff00; margin-bottom: 20px; }
        .pop-button { background: #00ff00; color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* --- 5. NEWS MODAL STYLES --- */
        .news-modal {
            display: none; 
            position: fixed; 
            z-index: 9999; 
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px);
        }
        .modal-content {
            background-color: #1f1f1f;
            color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 20px #00ff00;
            border: 1px solid #333;
        }
        .close-modal {
            position: sticky;
            top: 0;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: #00ff00;
        }
        #modalBody { 
            line-height: 1.6; 
            white-space: pre-wrap; 
            font-size: 1.1rem;
            color: #ddd;
        }
    </style>
</head>
<body>

<div class="my-perfect-layout">
    <header><h1>Clay County Portal</h1></header>
    <div id="content-area"></div>
    <footer>Â© 2026 Clay County</footer>
</div>

<div id="storyModal" class="news-modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeStory()">&times;</span>
        <h2 id="modalTitle" style="color:#00ff00;"></h2>
        <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
        <div id="modalBody"></div>
    </div>
</div>

<script>
// --- MODAL LOGIC ---
function openStory(title, content) {
    document.getElementById('modalTitle').innerText = title;
    document.getElementById('modalBody').innerText = content;
    document.getElementById('storyModal').style.display = "block";
    document.body.style.overflow = "hidden";
}

function closeStory() {
    document.getElementById('storyModal').style.display = "none";
    document.body.style.overflow = "auto";
}

window.onclick = function(event) {
    const modal = document.getElementById('storyModal');
    if (event.target == modal) { closeStory(); }
}

// --- PORTAL ROUTER LOGIC ---
async function loadPortal() {
    const contentDiv = document.getElementById('content-area');
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('type') || 'local-news'; 

    try {
        // FIXED URL TO PREVENT SYNC ERROR (Using absolute path)
        const res = await fetch('https://kfruti88.github.io/clay-county-news/news_data.json');
        if (!res.ok) throw new Error("Could not find the news database.");
        
        const data = await res.json();
        contentDiv.innerHTML = ''; 

        // --- MODULE 1: GAS PRICES ---
        if (slug === 'gas') {
            const fuelUrl = "https://kfruti88.github.io/Clay-County-Fuel/gas_prices.json";
            const fuelRes = await fetch(fuelUrl);
            const fuelData = await fuelRes.json();
            contentDiv.innerHTML = `<h2>Live Gas Prices</h2><div id="gas-board"></div>`;
            renderFuelBoard(fuelData); 
        } 
        
        // --- MODULE 2: TOWN NEWS (Snippet + Modal Pop-out) ---
        else if (slug !== 'local-news') {
            const filtered = data.filter(item => 
                item.tags.some(t => t.toLowerCase() === slug.toLowerCase())
            );
            
            if(filtered.length === 0) {
                contentDiv.innerHTML = `<h3>No specific news for ${slug} right now.</h3>`;
            }

            filtered.forEach(item => {
                // Clean strings for JS passing
                const cleanTitle = item.title.replace(/'/g, "\\'");
                const cleanBody = item.full_story.replace(/'/g, "\\'").replace(/\n/g, "\\n");

                contentDiv.innerHTML += `
                    <div class="news-card">
                        <h3>${item.title}</h3>
                        <p>${item.full_story.substring(0, 150)}...</p>
                        <button class="pop-button" onclick="openStory('${cleanTitle}', '${cleanBody}')">
                            Read More
                        </button>
                    </div>`;
            });
        } 

        // --- MODULE 3: LOCAL NEWS (#keep full story goes to https://supportmylocalcommunity.com/local-news/) ---
        else {
            data.forEach(item => {
                contentDiv.innerHTML += `
                    <div class="news-card">
                        <h2>${item.title}</h2>
                        <p style="color:#888; font-size:0.8rem;">Published: ${item.date}</p>
                        <div style="white-space: pre-wrap;">${item.full_story}</div>
                        <hr style="border-color:#333; margin:30px 0;">
                    </div>`;
            });
        }
    } catch (e) {
        contentDiv.innerHTML = `<div style="color:red; text-align:center; padding:40px;">
            <strong>Sync Error:</strong> ${e.message}<br>
            Please check that the JSON file is published at the correct URL.
        </div>`;
    }
}

function renderFuelBoard(data) {
    const board = document.getElementById('gas-board');
    if (!board) return;
    // Map through fuel data here...
    data.forEach(fuel => {
        board.innerHTML += `<p>${fuel.station}: ${fuel.price}</p>`;
    });
}

loadPortal();
</script>
</body>
</html>
