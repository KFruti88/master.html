<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clay County Master Portal</title>
    <style>
        /* --- THEME: BLACK, GREEN, WHITE --- */
        body { margin: 0; padding: 0; background: #000000; color: #ffffff; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .my-perfect-layout { display: flex; flex-direction: column; min-height: 100vh; }
        
        header { background: #000; padding: 15px; text-align: center; border-bottom: 3px solid #00ff00; }
        header h1 { color: #00ff00; margin: 0; text-transform: uppercase; letter-spacing: 2px; font-size: 1.5rem; }

        /* --- WIDGET BAR --- */
        .widget-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #111;
            padding: 8px 25px;
            font-size: 0.95rem;
            border-bottom: 1px solid #333;
        }
        #live-clock { font-weight: bold; color: #00ff00; font-family: 'Courier New', monospace; }
        #weather-widget { font-weight: bold; }

        /* --- DYNAMIC MENU BAR --- */
        nav { 
            background: #000; 
            padding: 12px; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 12px;
            border-bottom: 1px solid #333;
        }

        .nav-link { 
            text-decoration: none; 
            padding: 10px 18px; 
            font-weight: bold; 
            text-transform: uppercase; 
            font-size: 0.8rem; 
            transition: all 0.3s ease;
            border-radius: 5px;
            border: 1px solid transparent;
        }

        /* --- TOWN SPECIFIC HOVER SWAPS --- */
        /* Flora: Blue/Orange */
        .link-flora { background: #0000ff; color: #ffa500; }
        .link-flora:hover { background: #ffa500; color: #0000ff; border-color: #0000ff; }

        /* Louisville: Blue/White */
        .link-louisville { background: #00008b; color: #ffffff; }
        .link-louisville:hover { background: #ffffff; color: #00008b; border-color: #00008b; }

        /* Clay City: Purple/Gold */
        .link-claycity { background: #4b0082; color: #ffd700; }
        .link-claycity:hover { background: #ffd700; color: #4b0082; border-color: #4b0082; }

        /* Xenia: Red/White */
        .link-xenia { background: #cc0000; color: #ffffff; }
        .link-xenia:hover { background: #ffffff; color: #cc0000; border-color: #cc0000; }

        /* Sailor Springs: Green/White */
        .link-sailor { background: #006400; color: #ffffff; }
        .link-sailor:hover { background: #ffffff; color: #006400; border-color: #006400; }

        /* Default Links */
        .link-default { background: #222; color: #00ff00; }
        .link-default:hover { background: #00ff00; color: #000; }

        #content-area { flex: 1; padding: 25px; max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        .news-card { background: #000; padding: 25px; border: 1px solid #333; border-left: 6px solid #00ff00; margin-bottom: 30px; }
    </style>
</head>
<body>

<div class="my-perfect-layout">
    <header><h1>Clay County Portal</h1></header>

    <div class="widget-bar">
        <div id="live-clock">00:00:00 AM</div>
        <div id="weather-widget">Loading Weather...</div>
    </div>
    
    <nav>
        <a href="?type=local-news" class="nav-link link-default">Full News</a>
        <a href="https://ourflora.com" class="nav-link link-flora" target="_blank">Flora</a>
        <a href="https://supportmylocalcommunity.com/louisville/" class="nav-link link-louisville" target="_blank">Louisville</a>
        <a href="https://supportmylocalcommunity.com/clay-city/" class="nav-link link-claycity" target="_blank">Clay City</a>
        <a href="https://supportmylocalcommunity.com/xenia/" class="nav-link link-xenia" target="_blank">Xenia</a>
        <a href="https://supportmylocalcommunity.com/sailor-springs/" class="nav-link link-sailor" target="_blank">Sailor Springs</a>
        <a href="?type=gas" class="nav-link link-default">Gas Prices</a>
        <a href="?type=calendar" class="nav-link link-default">Calendar</a>
    </nav>
    
    <div id="content-area"></div>
</div>

<script>
// --- LIVE CLOCK (AM/PM) ---
function updateClock() {
    const now = new Date();
    document.getElementById('live-clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
}
setInterval(updateClock, 1000);
updateClock();

// --- WEATHER INTEGRATION (Zip: 62839) ---
async function fetchWeather() {
    const widget = document.getElementById('weather-widget');
    try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=38.67&longitude=-88.48&current=temperature_2m,apparent_temperature,weather_code&temperature_unit=fahrenheit`);
        const data = await res.json();
        
        const temp = Math.round(data.current.temperature_2m);
        const feelsLike = Math.round(data.current.apparent_temperature);
        const code = data.current.weather_code;
        
        let condition = "Clear";
        let color = "#00ff00"; // Clear/Default Green

        if (code >= 1 && code <= 3) { condition = "Cloudy"; color = "#a0a0a0"; }
        else if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) { condition = "Rainy"; color = "#3498db"; }
        else if (code >= 71 && code <= 77 || code === 85 || code === 86) { condition = "Snow"; color = "#ffffff"; }
        else if (code >= 95) { condition = "Stormy"; color = "#f1c40f"; }
        
        widget.style.color = color;
        widget.innerHTML = `${condition} ${temp}°F (Feels Like ${feelsLike}°F)`;
    } catch (e) { widget.innerText = "Weather Unavailable"; }
}
fetchWeather();
setInterval(fetchWeather, 600000); // Update every 10 mins

// --- MODULE ROUTING ---
async function loadPortal() {
    const contentDiv = document.getElementById('content-area');
    const urlParams = new URLSearchParams(window.location.search);
    const slug = urlParams.get('type') || 'local-news'; 

    try {
        if (slug === 'gas') {
            const res = await fetch('https://kfruti88.github.io/Clay-County-Fuel/gas_prices.json');
            const data = await res.json();
            contentDiv.innerHTML = '<h2 style="text-align:center;">Local Gas Prices</h2>';
            data.forEach(item => {
                contentDiv.innerHTML += `
                    <div class="news-card" style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:1.2rem; font-weight:bold;">${item.station || item.name}</span>
                        <span style="color:#00ff00; font-size:1.5rem; font-family:monospace;">${item.price}</span>
                    </div>`;
            });
        } 
        else if (slug === 'calendar') {
            contentDiv.innerHTML = `<h2 style="text-align:center;">Community Calendar</h2><iframe src="https://calendar.google.com/calendar/embed?src=ceab82d01e29c237da2e761555f2d2c2da76431b94e0def035ff04410e2cd71d%40group.calendar.google.com&ctz=America%2FNew_York" style="height:750px; border:none;" frameborder="0" scrolling="no"></iframe>`;
        }
        else {
            const res = await fetch('https://kfruti88.github.io/clay-county-news/news_data.json');
            const data = await res.json();
            contentDiv.innerHTML = '<h2 style="text-align:center;">Latest Full Stories</h2>';
            data.forEach(item => {
                contentDiv.innerHTML += `
                    <div class="news-card">
                        <h2>${item.title}</h2>
                        <p style="color:#666; font-size:0.8rem;">${item.date}</p>
                        <div style="white-space: pre-wrap; line-height:1.6; font-size:1.1rem;">${item.full_story}</div>
                    </div>`;
            });
        }
    } catch (e) { contentDiv.innerHTML = `<p style="text-align:center; color:red;">Updating Module...</p>`; }
}
loadPortal();
</script>
</body>
</html>
