<div class="my-perfect-layout">
    <header><h1>Clay County Portal</h1></header>
    
    <div id="content-area">
        </div>

    <footer>Â© 2024 Clay County</footer>
</div>

<script>
async function loadMasterContent() {
    const contentDiv = document.getElementById('content-area');
    
    // 1. Get the "Label" from the URL parameter (sent by Divi)
    const urlParams = new URLSearchParams(window.location.search);
    const label = urlParams.get('type') || 'default'; 

    try {
        // 2. Fetch your central "Getter" config file
        const configRes = await fetch('https://kfruti88.github.io/clay-county-news/config.json');
        const config = await configRes.json();

        // 3. Find the URL that matches your label
        const targetUrl = config[label];

        if (!targetUrl) throw new Error("Label '" + label + "' not found in config.json");

        // 4. Fetch the actual content
        const response = await fetch(targetUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const html = await response.text();
        
        // This drops the code into your 'locked' frame
        contentDiv.innerHTML = html;
        
        // 5. CRITICAL: Re-run scripts so trackers/calendars stay live
        const scripts = contentDiv.getElementsByTagName('script');
        for (let script of scripts) {
            const s = document.createElement("script");
            if (script.src) {
                s.src = script.src;
            } else {
                s.textContent = script.textContent;
            }
            document.body.appendChild(s);
        }
    } catch (e) {
        contentDiv.innerHTML = `<p style='color:red; text-align:center; padding:20px;'>
            Error: ${e.message}<br>
            <small>Make sure your CSS Class in Divi matches a key in config.json</small>
        </p>`;
    }
}

// 6. START THE GETTER
loadMasterContent();
</script>
